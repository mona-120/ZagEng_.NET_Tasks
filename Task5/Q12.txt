namespace Linq_Task
{
    internal class Program
    {
        static void Main(string[] args)
        {
            List<Course> courses =
            [
                new("C# Basics" , ["Ali","Sara","Omar"]),
                new("LINQ Mastery" , ["Sara","Mona","Ali"]),
                new("ASP.NET Core" , ["Yara","Omar","Karim"])
            ];

            List<Employee> employees =
            [
                 new ("Ali", "Engineering", 9000m),
                 new ("Sara", "Engineering", 8500m),
                 new ("Omar", "HR", 6000m),
                 new ("Mona", "HR", 6200m),
                 new ("Yara", "Marketing", 7000m),
                 new ("Karim", "Marketing", 7500m),
                 new ("Nada", "Engineering", 9500m)
            ];

            // Get the TOP 2 highest-paid employees per department
            var Top2Paid = employees.GroupBy(e => e.Department)
                                    .SelectMany(g => g.OrderByDescending(e => e.Salary).Take(2));
            Console.WriteLine("TOP 2 highest-paid employees per department:");
            // Deffered execution as values are stored in Top2Paid in run time

            foreach (var emp in Top2Paid)
            {
                Console.WriteLine($"Department: {emp.Department}  EmployeeName: {emp.Name}");

            }
            

            // Dictionary of { CourseName , StudentCount } -> courses has more than 2 students
            Dictionary<string, int> CoursesWithMore2Students = courses.Where(c => c.Students.Count > 2)
                                                                      .Select(c => new
                                                                      {
                                                                          CourseName = c.Title,
                                                                          StudentCount = c.Students.Count()
                                                                      }).ToDictionary(c => c.CourseName , c => c.StudentCount);
            // immediate execution due to use 'ToDictionary' make value stored in compile time
            Console.WriteLine("\nCourses with more than 2 students: ");
            foreach (var course in CoursesWithMore2Students)
            {
                Console.WriteLine($"{course.Key} â†’ {course.Value}");
            }


            // check
            // ANY employee in Engineering earn less than 8000
            var CheckEngSalary = employees.Any(e => e.Department == "Engineering" && e.Salary < 8000m);
            Console.WriteLine($"\nDoes ANY employee in Engineering earn less than 8000? {CheckEngSalary}");

            // ALL HR employees earn more than 5500
            var CheckHRSalary = employees.Where(e => e.Department == "HR")
                                          .All(e => e.Salary > 5500m);
            Console.WriteLine($"Do ALL HR employees earn more than 5500?  {CheckHRSalary}");
            // Any and All immediate execution

            // Project the top-2-per-dept result into { Rank, Name, Department, Salary, SeniorityLevel }
            var ProjectedTop2Paid = employees.GroupBy(e => e.Department)
                                    .SelectMany(g => g.OrderByDescending(e => e.Salary).Take(2))
                                    .Select((e,index) => new
                                    {  
                                        Rank = index,
                                        e.Name ,
                                        e.Department,
                                        e.Salary,
                                        SeniorityLevel = e.Salary >= 9000 ? "Senior" : e.Salary >= 7000 ? "Mid" : "Junior"
                                    });
            // Deferred execution as there is no operators that make it immediate
            Console.WriteLine("/nProjected Top 2 Paid:");
            foreach (var emp in ProjectedTop2Paid)
            {
                Console.WriteLine($"Rank: {emp.Rank} , Name: {emp.Name} Department: {emp.Department} , Salary: {emp.Salary} , SeniorityLevel: {emp.SeniorityLevel}");

            }

        }


    }
    record Course(string Title, List<string> Students);
    record Employee(string Name, string Department, decimal Salary);
}